@page "/"
@inject WeatherService WeatherService
@inject GeoCodingService GeoCodingService
@using BuccaneersWeatherWatch.Web.Models;
@using BuccaneersWeatherWatch.Web.Services;
@using BuccaneersWeatherWatch.Web.Shared

<PageTitle>Home</PageTitle>


<MudText Typo="Typo.h4">Weather forecast</MudText>
<MudButton OnClick="WeatherCall">Get Winnipeg Weather</MudButton>

@if(_weatherData != null && _geoCodingData != null && _geoCodingData.Count > 0)
{
    @foreach (var location in _geoCodingData)
    {
        <MudText>@location.Display_name</MudText>
    }

    <MudDivider />

    <MudText>Longitude: @_weatherData.Longitude</MudText>
    <MudText>Latitude: @_weatherData.Latitude</MudText>
    <MudText>Timezone: @_weatherData.Timezone</MudText>
}

@code {
    private string? _searchString;

    private WeatherData? _weatherData;
    private List<GeoCodingLocationData>? _geoCodingData;

    public async Task WeatherCall()
    {
        _geoCodingData = await GeoCodingService.GetGeoCodingDataAsync("winnipeg manitoba".ToLower());

        var firstSelection = _geoCodingData.FirstOrDefault()!;

        var latitude = double.Parse(firstSelection.Lat);
        var longitude = double.Parse(firstSelection.Lon);
        

        _weatherData = await WeatherService.GetWeatherDataAsync(latitude, longitude);

        
    }
}
